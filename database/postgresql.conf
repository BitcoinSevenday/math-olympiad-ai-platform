# macOS开发环境优化配置

# 连接设置
listen_addresses = '*'      # 监听所有地址
port = 5432                # 默认端口
max_connections = 100      # 开发环境足够

# 内存设置（针对Apple Silicon 16GB内存优化）
shared_buffers = 256MB     # 共享缓冲区
work_mem = 8MB             # 每个操作的排序内存
maintenance_work_mem = 64MB # 维护操作内存

# 检查点优化
checkpoint_timeout = 10min  # 检查点间隔
checkpoint_completion_target = 0.7  # 完成目标

# 日志设置
log_destination = 'stderr'
logging_collector = on
log_directory = 'log'
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'
log_rotation_age = 1d
log_rotation_size = 10MB
log_min_duration_statement = 1000  # 记录执行超过1秒的语句

# 性能监控
shared_preload_libraries = 'pg_stat_statements'
pg_stat_statements.max = 10000
pg_stat_statements.track = all

# WAL设置（写前日志）
wal_level = replica
max_wal_size = 1GB
min_wal_size = 80MB

# 并行查询（针对多核M2 Pro）
max_parallel_workers_per_gather = 2
max_parallel_workers = 4
max_parallel_maintenance_workers = 2

# 其他优化
effective_cache_size = 2GB
random_page_cost = 1.1     # SSD优化
effective_io_concurrency = 200
